# Development Dockerfile with standard Rust setup
FROM rust:1.75

# Install required dependencies for development
RUN apt-get update && apt-get install -y \
    pkg-config \
    golang-go \
    tmux \
    vim \
    graphviz \
    nodejs \
    npm \
    && rm -rf /var/lib/apt/lists/*

# Install latest pprof for profiling
RUN go install github.com/google/pprof@latest

# Set working directory
WORKDIR /workspace

# Copy rust-toolchain to ensure correct Rust version
COPY rust-toolchain ./

# Install the correct Rust toolchain based on rust-toolchain file
RUN rustup toolchain install $(cat rust-toolchain) && \
    rustup default $(cat rust-toolchain) && \
    rustup component add rustfmt clippy

# Set up Rust environment variables
ENV PATH="/usr/local/cargo/bin:${PATH}"
ENV RUSTUP_HOME="/usr/local/rustup"
ENV CARGO_HOME="/usr/local/cargo"
ENV RUST_BACKTRACE=1

# Create tmp directory with proper permissions
RUN mkdir -p tmp && chmod 777 tmp

# Default command for development
CMD ["/bin/bash"]

